/*!
 * Web Cabin Play - Node based visual scripting tool.
 *
 * Dependancies:
 *  JQuery 1.11.1
 *  font-awesome 4.2.0
 * Optional Dependencies:
 *  FileSaver.js
 *  wcUndoManager
 *
 * Author: Jeff Houde (lochemage@webcabin.org)
 * Web: https://play.webcabin.org/
 * API: https://play.api.webcabin.org/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */
function wcPlay(e){this._compositeNodes=[],this._entryNodes=[],this._processNodes=[],this._storageNodes=[],this._properties=[],this._queuedChain=[],this._queuedProperties=[],this._importedScripts=[],this._updateID=0,this._isPaused=!1,this._isStepping=!1,this._editors=[],this._options={silent:!1,updateRate:25,updateLimit:100,debugging:!0};for(var t in e)this._options[t]=e[t]}(function(){var e=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;window.wcNodeInstances={},this.Class=function(){},Class.extend=function(){function u(){e?this.classInit&&this.classInit.apply(this,arguments[0]):(window.wcNodeInstances[this.className].push(this),this.init&&this.init.apply(this,arguments))}var n=arguments[0],r=arguments[arguments.length-1],i=this.prototype;e=!0;var s=new this(arguments);e=!1;for(var o in r)s[o]=typeof r[o]=="function"&&typeof i[o]=="function"&&t.test(r[o])?function(e,t){return function(){var n=this._super;this._super=i[e];var r=t.apply(this,arguments);return this._super=n,r}}(o,r[o]):r[o];u.prototype=s,u.prototype.constructor=u,u.extend=arguments.callee,window[n]=u,window.wcNodeInstances[n]=[]}})(),wcPlay.PROPERTY={DYNAMIC:"dynamic",TOGGLE:"toggle",NUMBER:"number",STRING:"string",SELECT:"select",CUSTOM:"custom"},wcPlay.NODE={ENTRY:"entry",PROCESS:"process",STORAGE:"storage",COMPOSITE:"composite"},wcPlay.NODE_LIBRARY=[],wcPlay.registerNodeType=function(e,t,n,r){for(var i=0;i<wcPlay.NODE_LIBRARY.length;++i)if(wcPlay.NODE_LIBRARY[i].name===e)return!1;return wcPlay.NODE_LIBRARY.push({className:e,displayName:t,category:n,nodeType:r}),!0},wcPlay.prototype={start:function(){this.reset(),this._isPaused=!1,this._isStepping=!1;if(!this._updateId){var e=this;this._updateID=setInterval(function(){e.update()},this._options.updateRate)}this.__notifyNodes("onStart",[])},reset:function(){for(var e=0;e<this._compositeNodes.length;++e)this._compositeNodes[e].reset();for(var e=0;e<this._entryNodes.length;++e)this._entryNodes[e].reset();for(var e=0;e<this._processNodes.length;++e)this._processNodes[e].reset();for(var e=0;e<this._storageNodes.length;++e)this._storageNodes[e].reset();this._queuedChain=[],this._queuedProperties=[];for(var e=0;e<this._properties.length;++e)this.property(this._properties[e].name,this._properties[e].initialValue,!0)},clear:function(){this._queuedChain=[],this._queuedProperties=[],this._properties=[];while(this._compositeNodes.length)this._compositeNodes[0].destroy();while(this._entryNodes.length)this._entryNodes[0].destroy();while(this._processNodes.length)this._processNodes[0].destroy();while(this._storageNodes.length)this._storageNodes[0].destroy()},save:function(){var e={};e.properties=this.listProperties(),e.nodes=[];for(var t=0;t<this._entryNodes.length;++t)e.nodes.push(this._entryNodes[t].export());for(var t=0;t<this._processNodes.length;++t)e.nodes.push(this._processNodes[t].export());for(var t=0;t<this._storageNodes.length;++t)e.nodes.push(this._storageNodes[t].export());for(var t=0;t<this._compositeNodes.length;++t)e.nodes.push(this._compositeNodes[t].export());return JSON.stringify(e,function(e,t){return t==Infinity?"Infinity":t})},load:function(e){var t=this.save();try{var n=JSON.parse(e,function(e,t){return t==="Infinity"?Infinity:t});this.clear();for(var r=0;r<n.properties.length;++r)this.createProperty(n.properties[r].name,n.properties[r].type,n.properties[r].initialValue,n.properties[r].options);var i=[];for(var r=0;r<n.nodes.length;++r)if(window[n.nodes[r].className]){var s=new window[n.nodes[r].className](this,n.nodes[r].pos,n.nodes[r].name);i.push({node:s,data:n.nodes[r]})}else console.log('ERROR: Attempted to load node "'+n.nodes[r].className+'", but the constructor could not be found!');for(var r=0;r<i.length;++r)i[r].node.import(i[r].data);return this.reset(),!0}catch(o){this.restore(t)}return!1},"import":function(e,t){var n=null;try{var r=JSON.parse(e,function(e,t){return t==="Infinity"?Infinity:t});return r.pos={x:0,y:0},n=new wcNodeCompositeScript(this,r.pos),n.nodeType=wcPlay.NODE.COMPOSITE,n.category="Imported",r.id=n.id,r.name=t,r.color=n.color,r.collapsed=!1,r.breakpoint=!1,r.properties=[],r.entryChains=[],r.exitChains=[],r.inputChains=[],r.outputChains=[],n.import(r),n._parent=null,this.__removeNode(n),this._importedScripts.push(n),!0}catch(i){n&&n.destroy()}return!1},importedComposites:function(){return this._importedScripts},update:function(){if(this._isPaused)return;var e=Math.min(this._queuedProperties.length,this._options.updateLimit),t=e;while(t){t--;var n=this._queuedProperties.shift();n.node._meta.flash=!0,n.node._meta.paused>0&&n.node._meta.paused--,n.node.property(n.name,n.value,n.upstream?!1:undefined,n.upstream)}if(!e){e=Math.min(this._queuedChain.length,this._options.updateLimit-e),t=e;while(t){t--;var n=this._queuedChain.shift();n.node._meta.flash=!0,n.node._meta.paused&&n.node._meta.paused--,n.node.onTriggered(n.name)}}this._isStepping&&(this._isPaused=!0)},nodeById:function(e){for(var t=0;t<this._compositeNodes.length;++t)if(this._compositeNodes[t].id===e)return this._compositeNodes[t];for(var t=0;t<this._entryNodes.length;++t)if(this._entryNodes[t].id===e)return this._entryNodes[t];for(var t=0;t<this._processNodes.length;++t)if(this._processNodes[t].id===e)return this._processNodes[t];for(var t=0;t<this._storageNodes.length;++t)if(this._storageNodes[t].id===e)return this._storageNodes[t];for(var t=0;t<this._compositeNodes.length;++t)if(this._compositeNodes[t]instanceof wcNodeCompositeScript){var n=this._compositeNodes[t].nodeById(e);if(n)return n}return null},silent:function(e){return e!==undefined&&(this._options.silent=e?!0:!1),this._options.silent},debugging:function(e){return e!==undefined&&(this._options.debugging=e?!0:!1),this._options.debugging},paused:function(e){return e!==undefined&&(this._isPaused=e?!0:!1),this._isPaused},stepping:function(e){return e!==undefined&&(this._isStepping=e?!0:!1),this._isStepping},createProperty:function(e,t,n,r){for(var i=0;i<this._properties.length;++i)if(this._properties[i].name===e)return!1;return n===undefined&&(n=0),this._properties.push({name:e,value:n,initialValue:n,type:t,options:r||{}}),!0},renameProperty:function(e,t){var n=null;for(var r=0;r<this._properties.length;++r){if(this._properties[r].name===t)return!1;this._properties[r].name===e&&(n=this._properties[r])}if(!n)return!1;n.name=t,this.__notifyNodes("onGlobalPropertyRenamed",[e,t])},removeProperty:function(e){for(var t=0;t<this._properties.length;++t)if(this._properties[t].name===e)return this.__notifyNodes("onGlobalPropertyRemoved",[e]),this._properties.splice(t,1),!0;return!1},property:function(e,t){var n=null;for(var r=0;r<this._properties.length;++r)if(this._properties[r].name===e){n=this._properties[r];break}if(!n)return;if(t!==undefined&&t!==n.value){var i=n.value;n.value=t,this.__notifyNodes("onGlobalPropertyChanged",[n.name,i,n.value])}return n.value},initialProperty:function(e,t){var n=null;for(var r=0;r<this._properties.length;++r)if(this._properties[r].name===e){n=this._properties[r];break}if(!n)return;if(t!==undefined&&t!==n.initialValue){var i=n.initialValue;n.initialValue=t,n.value==i&&(n.value=t,this.__notifyNodes("onGlobalInitialPropertyChanged",[n.name,i,n.value]))}return n.initialValue},listProperties:function(){var e=[];for(var t=0;t<this._properties.length;++t){var n=this._properties[t];e.push({name:n.name,value:n.value,initialValue:n.initialValue,type:n.type,options:n.options})}return e},triggerEvent:function(e,t){for(var n=0;n<this._entryNodes.length;++n)this._entryNodes[n].name===e&&this._entryNodes[n].onTriggered(t)},queueNodeEntry:function(e,t){if(e.enabled()){this._queuedChain.push({node:e,name:t});if(e.debugBreak()||this._isStepping)e._meta.flash=!0,e._meta.paused++,this._isPaused=!0}},queueNodeProperty:function(e,t,n,r){if(e.enabled()){this._queuedProperties.push({node:e,name:t,value:n,upstream:r});if(e.debugBreak()||this._isStepping)e._meta.flash=!0,e._meta.paused++,this._isPaused=!0}},__addNode:function(e){e instanceof wcNodeComposite?this._compositeNodes.push(e):e instanceof wcNodeEntry?this._entryNodes.push(e):e instanceof wcNodeProcess?this._processNodes.push(e):e instanceof wcNodeStorage&&this._storageNodes.push(e)},__removeNode:function(e){var t=-1;e instanceof wcNodeComposite?(t=this._compositeNodes.indexOf(e),t>-1&&this._compositeNodes.splice(t,1)):e instanceof wcNodeEntry?(t=this._entryNodes.indexOf(e),t>-1&&this._entryNodes.splice(t,1)):e instanceof wcNodeProcess?(t=this._processNodes.indexOf(e),t>-1&&this._processNodes.splice(t,1)):e instanceof wcNodeStorage&&(t=this._storageNodes.indexOf(e),t>-1&&this._storageNodes.splice(t,1));if(t===-1)for(var n=0;n<this._compositeNodes.length;++n)if(this._compositeNodes[n]instanceof wcNodeCompositeScript&&this._compositeNodes[n].__removeNode(e))return!0;return!1},__notifyNodes:function(e,t){var n;for(var r=0;r<this._compositeNodes.length;++r)n=this._compositeNodes[r],typeof n[e]=="function"&&n[e].apply(n,t);for(var r=0;r<this._entryNodes.length;++r)n=this._entryNodes[r],typeof n[e]=="function"&&n[e].apply(n,t);for(var r=0;r<this._processNodes.length;++r)n=this._processNodes[r],typeof n[e]=="function"&&n[e].apply(n,t);for(var r=0;r<this._storageNodes.length;++r)n=this._storageNodes[r],typeof n[e]=="function"&&n[e].apply(n,t);for(var r=0;r<this._compositeNodes.length;++r)this._compositeNodes[r]instanceof wcNodeCompositeScript&&this._compositeNodes[r].__notifyNodes(e,t)},__notifyEditors:function(e,t){var n;for(var r=0;r<this._editors.length;++r)n=this._editors[r],typeof n[e]=="function"&&n[e].apply(n,t)}};var wcNodeNextID=0;Class.extend("wcNode","Node","",{init:function(e,t){this.id=++wcNodeNextID,this.color="#FFFFFF",this.name||(this.name=""),this._viewportSize=null,this.pos={x:t&&t.x||0,y:t&&t.y||0},this.chain={entry:[],exit:[]},this.properties=[],this._meta={flash:!1,flashDelta:0,color:null,paused:0,awake:!1,dirty:!0,threads:[],description:""},this._collapsed=!0,this._break=!1,this._log=!1,this._parent=e,this.createProperty(wcNode.PROPERTY_ENABLED,wcPlay.PROPERTY.TOGGLE,!0,{description:"Disabled nodes will be treated as if they were not there, all connections will be ignored."}),this._parent&&this._parent.__addNode(this)},destroy:function(){this.onDestroying();for(var e=0;e<this.chain.entry.length;++e){var t=this.chain.entry[e];this.disconnectEntry(t.name)}for(var e=0;e<this.chain.exit.length;++e){var t=this.chain.exit[e];this.disconnectExit(t.name)}for(var e=0;e<this.properties.length;++e){var t=this.properties[e];this.disconnectInput(t.name),this.disconnectOutput(t.name)}this.reset();var n=window.wcNodeInstances[this.className].indexOf(this);n===-1&&console.log("ERROR: Could not remove instance of node."),window.wcNodeInstances[this.className].splice(n,1),this._parent&&this._parent.__removeNode(this),this.onDestroyed()},reset:function(){this.onReset();for(var e=0;e<this._meta.threads.length;++e)typeof this._meta.threads[e]=="number"?(clearTimeout(this._meta.threads[e]),clearInterval(this._meta.threads[e])):typeof this._meta.threads[e]=="function"&&this._meta.threads[e]();this._meta.threads=[],this._meta.awake=!1,this._meta.dirty=!0;for(var e=0;e<this.properties.length;++e)this.properties[e].value=this.properties[e].initialValue},"import":function(e,t){this.onImporting(e,t),this.id=t&&t[e.id]||e.id,this.name=e.name,this.color=e.color,this.pos.x=e.pos.x,this.pos.y=e.pos.y,this.collapsed(e.collapsed),this.debugBreak(e.breakpoint),this.id>wcNodeNextID&&(wcNodeNextID=this.id);for(var n=0;n<e.properties.length;++n)this.initialProperty(e.properties[n].name,e.properties[n].initialValue),this.property(e.properties[n].name,e.properties[n].value);var r=this.engine();if(!r)return;for(var n=0;n<e.entryChains.length;++n){var i=e.entryChains[n],s=r.nodeById(t&&t[i.outNodeId]||i.outNodeId);s&&this._parent===s._parent&&this.connectEntry(i.inName,s,i.outName)}for(var n=0;n<e.exitChains.length;++n){var i=e.exitChains[n],s=r.nodeById(t&&t[i.inNodeId]||i.inNodeId);s&&this._parent===s._parent&&this.connectExit(i.outName,s,i.inName)}for(var n=0;n<e.inputChains.length;++n){var i=e.inputChains[n],s=r.nodeById(t&&t[i.outNodeId]||i.outNodeId);s&&this._parent===s._parent&&this.connectInput(i.inName,s,i.outName)}for(var n=0;n<e.outputChains.length;++n){var i=e.outputChains[n],s=r.nodeById(t&&t[i.inNodeId]||i.inNodeId);s&&this._parent===s._parent&&this.connectOutput(i.outName,s,i.inName)}this._meta.dirty=!0,this.onImported(e,t)},"export":function(){var e={className:this.className,id:this.id,name:this.name,color:this.color,pos:{x:this.pos.x,y:this.pos.y},collapsed:this.collapsed(),breakpoint:this._break,properties:this.listProperties(),entryChains:this.listEntryChains(),exitChains:this.listExitChains(),inputChains:this.listInputChains(),outputChains:this.listOutputChains()};return this.onExport(e),e},engine:function(){var e=this._parent;while(e&&!(e instanceof wcPlay))e=e._parent;return e||null},enabled:function(e){return e!==undefined&&(this.property(wcNode.PROPERTY_ENABLED,e?!0:!1),this._meta.dirty=!0),this.property(wcNode.PROPERTY_ENABLED)},isPaused:function(){return this._meta.paused>0},debugLog:function(e){e!==undefined&&(this._log=e?!0:!1);var t=this.engine();return!t||t.silent()?!1:this._log},debugBreak:function(e){e!==undefined&&(this._break=e?!0:!1);var t=this.engine();return t&&t.debugging()&&this._break},collapsed:function(e){return e!==undefined&&(this._collapsed=e,this._meta.dirty=!0),this._collapsed},description:function(e){return e!==undefined&&(this._meta.description=e),this._meta.description},beginThread:function(e){return this._meta.threads.push(e),this._meta.flash=!0,this._meta.awake=!0,e},finishThread:function(e){var t=this._meta.threads.indexOf(e);t>-1&&(this._meta.threads.splice(t,1),this._meta.threads.length||(this._meta.awake=!1))},pos:function(e){return e!==undefined&&(this.pos.x=e.x,this.pos.y=e.y,this._meta.dirty=!0),{x:this.pos.x,y:this.pos.y}},createEntry:function(e,t){for(var n=0;n<this.chain.entry.length;++n)if(this.chain.entry[n].name===e)return!1;return this.chain.entry.push({name:e,active:!1,links:[],meta:{flash:!1,flashDelta:0,paused:0,color:"#000000",description:t}}),this._meta.dirty=!0,!0},createExit:function(e,t){for(var n=0;n<this.chain.exit.length;++n)if(this.chain.exit[n].name===e)return!1;return this.chain.exit.push({name:e,links:[],meta:{flash:!1,flashDelta:0,paused:0,color:"#000000",description:t}}),this._meta.dirty=!0,!0},createProperty:function(e,t,n,r){for(var i=0;i<this.properties.length;++i)if(this.properties[i].name===e)return!1;return n===undefined&&(n=0),this.properties.push({name:e,value:n,initialValue:n,type:t,inputs:[],outputs:[],options:r||{},inputMeta:{flash:!1,flashDelta:0,paused:0,color:"#000000"},outputMeta:{flash:!1,flashDelta:0,paused:0,color:"#000000"}}),this._meta.dirty=!0,!0},removeEntry:function(e){for(var t=0;t<this.chain.entry.length;++t)if(this.chain.entry[t].name===e&&this.disconnectEntry(e)===wcNode.CONNECT_RESULT.SUCCESS)return this.chain.entry.splice(t,1),this._meta.dirty=!0,!0;return!1},removeExit:function(e){for(var t=0;t<this.chain.exit.length;++t)if(this.chain.exit[t].name===e&&this.disconnectExit(e)===wcNode.CONNECT_RESULT.SUCCESS)return this.chain.exit.splice(t,1),this._meta.dirty=!0,!0;return!1},removeProperty:function(e){for(var t=0;t<this.properties.length;++t)if(this.properties[t].name===e&&this.disconnectInput(e)===wcNode.CONNECT_RESULT.SUCCESS&&this.disconnectOutput(e)===wcNode.CONNECT_RESULT.SUCCESS)return this.properties.splice(t,1),this._meta.dirty=!0,!0;return!1},renameEntry:function(e,t){if(!this.createEntry(t))return!1;if(this.createEntry(e))return this.removeEntry(e),this.removeEntry(t),!1;var n=this.listEntryChains(e);this.removeEntry(e);var r=this.engine();if(r)for(var i=0;i<n.length;++i)this.connectEntry(t,r.nodeById(n[i].outNodeId),n[i].outName);return this._meta.dirty=!0,!0},renameExit:function(e,t){if(!this.createExit(t))return!1;if(this.createExit(e))return this.removeExit(e),this.removeExit(t),!1;var n=this.listExitChains(e);this.removeExit(e);var r=this.engine();if(r)for(var i=0;i<n.length;++i)this.connectExit(t,r.nodeById(n[i].inNodeId),n[i].inName);return this._meta.dirty=!0,!0},renameProperty:function(e,t){var n;for(var r=0;r<this.properties.length;++r){this.properties[r].name===e&&(n=this.properties[r]);if(this.properties[r].name===t)return!1}if(!n)return!1;this.createProperty(t,n.type,n.initialValue,n.options),this.property(t,n.value,!1);var i=this.listInputChains(e),s=this.listOutputChains(e);this.removeProperty(e);var o=this.engine();if(o){for(var r=0;r<i.length;++r)this.connectInput(t,o.nodeById(i[r].outNodeId),i[r].outName);for(var r=0;r<s.length;++r)this.connectOutput(t,o.nodeById(s[r].inNodeId),s[r].inName)}return this._meta.dirty=!0,!0},connectEntry:function(e,t,n){if(t instanceof wcNode){var r=null,i=null;for(var s=0;s<this.chain.entry.length;++s)if(this.chain.entry[s].name===e){r=this.chain.entry[s];break}for(var s=0;s<t.chain.exit.length;++s)if(t.chain.exit[s].name===n){i=t.chain.exit[s];break}if(!r||!i)return wcNode.CONNECT_RESULT.NOT_FOUND;for(var s=0;s<r.links.length;++s)if(r.links[s].node===t&&r.links[s].name===i.name)return wcNode.CONNECT_RESULT.ALREADY_CONNECTED;for(var s=0;s<i.links.length;++s)if(i.links[s].node===this&&i.links[s].name===r.name)return wcNode.CONNECT_RESULT.ALREADY_CONNECTED;return r.links.push({name:i.name,node:t}),i.links.push({name:r.name,node:this}),this.onConnect(!0,r.name,wcNode.LINK_TYPE.ENTRY,t,i.name,wcNode.LINK_TYPE.EXIT),t.onConnect(!0,i.name,wcNode.LINK_TYPE.EXIT,this,r.name,wcNode.LINK_TYPE.ENTRY),wcNode.CONNECT_RESULT.SUCCESS}return wcNode.CONNECT_RESULT.NOT_FOUND},connectExit:function(e,t,n){if(t instanceof wcNode){var r=null,i=null;for(var s=0;s<this.chain.exit.length;++s)if(this.chain.exit[s].name===e){r=this.chain.exit[s];break}for(var s=0;s<t.chain.entry.length;++s)if(t.chain.entry[s].name===n){i=t.chain.entry[s];break}if(!r||!i)return wcNode.CONNECT_RESULT.NOT_FOUND;for(var s=0;s<r.links.length;++s)if(r.links[s].node===t&&r.links[s].name===i.name)return wcNode.CONNECT_RESULT.ALREADY_CONNECTED;for(var s=0;s<i.links.length;++s)if(i.links[s].node===this&&i.links[s].name===r.name)return wcNode.CONNECT_RESULT.ALREADY_CONNECTED;return r.links.push({name:i.name,node:t}),i.links.push({name:r.name,node:this}),this.onConnect(!0,r.name,wcNode.LINK_TYPE.EXIT,t,i.name,wcNode.LINK_TYPE.ENTRY),t.onConnect(!0,i.name,wcNode.LINK_TYPE.ENTRY,this,r.name,wcNode.LINK_TYPE.EXIT),wcNode.CONNECT_RESULT.SUCCESS}return wcNode.CONNECT_RESULT.NOT_FOUND},connectInput:function(e,t,n){if(t instanceof wcNode){var r=null,i=null;for(var s=0;s<this.properties.length;++s)if(this.properties[s].name===e){r=this.properties[s];break}for(var s=0;s<t.properties.length;++s)if(t.properties[s].name===n){i=t.properties[s];break}if(!r||!i)return wcNode.CONNECT_RESULT.NOT_FOUND;for(var s=0;s<r.inputs.length;++s)if(r.inputs[s].node===t&&r.inputs[s].name===i.name)return wcNode.CONNECT_RESULT.ALREADY_CONNECTED;for(var s=0;s<i.outputs.length;++s)if(i.outputs[s].node===this&&i.outputs[s].name===r.name)return wcNode.CONNECT_RESULT.ALREADY_CONNECTED;return r.inputs.push({name:i.name,node:t}),i.outputs.push({name:r.name,node:this}),this.onConnect(!0,r.name,wcNode.LINK_TYPE.INPUT,t,i.name,wcNode.LINK_TYPE.OUTPUT),t.onConnect(!0,i.name,wcNode.LINK_TYPE.OUTPUT,this,r.name,wcNode.LINK_TYPE.INPUT),wcNode.CONNECT_RESULT.SUCCESS}return wcNode.CONNECT_RESULT.NOT_FOUND},connectOutput:function(e,t,n){if(t instanceof wcNode){var r=null,i=null;for(var s=0;s<this.properties.length;++s)if(this.properties[s].name===e){r=this.properties[s];break}for(var s=0;s<t.properties.length;++s)if(t.properties[s].name===n){i=t.properties[s];break}if(!r||!i)return wcNode.CONNECT_RESULT.NOT_FOUND;for(var s=0;s<r.outputs.length;++s)if(r.outputs[s].node===t&&r.outputs[s].name===i.name)return wcNode.CONNECT_RESULT.ALREADY_CONNECTED;for(var s=0;s<i.inputs.length;++s)if(i.inputs[s].node===this&&i.inputs[s].name===r.name)return wcNode.CONNECT_RESULT.ALREADY_CONNECTED;return r.outputs.push({name:i.name,node:t}),i.inputs.push({name:r.name,node:this}),this.onConnect(!0,r.name,wcNode.LINK_TYPE.OUTPUT,t,i.name,wcNode.LINK_TYPE.INPUT),t.onConnect(!0,i.name,wcNode.LINK_TYPE.INPUT,this,r.name,wcNode.LINK_TYPE.OUTPUT),wcNode.CONNECT_RESULT.SUCCESS}return wcNode.CONNECT_RESULT.NOT_FOUND},disconnectEntry:function(e,t,n){var r=null;for(var i=0;i<this.chain.entry.length;++i)if(this.chain.entry[i].name===e){r=this.chain.entry[i];break}if(!r)return wcNode.CONNECT_RESULT.NOT_FOUND;for(var i=0;i<r.links.length;++i){var s=r.links[i];(!t||t===s.node)&&(!n||n===s.name)&&(r.links.splice(i,1),i--,s.node.disconnectExit(s.name,this,e))}return wcNode.CONNECT_RESULT.SUCCESS},disconnectExit:function(e,t,n){var r=null;for(var i=0;i<this.chain.exit.length;++i)if(this.chain.exit[i].name===e){r=this.chain.exit[i];break}if(!r)return wcNode.CONNECT_RESULT.NOT_FOUND;for(var i=0;i<r.links.length;++i){var s=r.links[i];(!t||t===s.node)&&(!n||n===s.name)&&(r.links.splice(i,1),i--,s.node.disconnectEntry(s.name,this,e))}return wcNode.CONNECT_RESULT.SUCCESS},disconnectInput:function(e,t,n){var r=null;for(var i=0;i<this.properties.length;++i)if(this.properties[i].name===e){r=this.properties[i];break}if(!r)return wcNode.CONNECT_RESULT.NOT_FOUND;for(var i=0;i<r.inputs.length;++i){var s=r.inputs[i];(!t||t===s.node)&&(!n||n===s.name)&&(r.inputs.splice(i,1),i--,s.node.disconnectOutput(s.name,this,e))}return wcNode.CONNECT_RESULT.SUCCESS},disconnectOutput:function(e,t,n){var r=null;for(var i=0;i<this.properties.length;++i)if(this.properties[i].name===e){r=this.properties[i];break}if(!r)return wcNode.CONNECT_RESULT.NOT_FOUND;for(var i=0;i<r.outputs.length;++i){var s=r.outputs[i];(!t||t===s.node)&&(!n||n===s.name)&&(r.outputs.splice(i,1),i--,s.node.disconnectInput(s.name,this,e))}return wcNode.CONNECT_RESULT.SUCCESS},activateEntry:function(e){for(var t=0;t<this.chain.entry.length;++t)if(this.chain.entry[t].name==e){var n=this.engine();return this.chain.entry[t].meta.flash=!0,(this.debugBreak()||n&&n.stepping())&&this.chain.entry[t].meta.paused++,n&&n.queueNodeEntry(this,this.chain.entry[t].name),!0}return!1},activateExit:function(e){if(!this.enabled())return!1;this.debugLog()&&console.log('DEBUG: Node "'+this.category+"."+this.type+(this.name?" ("+this.name+")":"")+'" Triggered Exit link "'+e+'"');for(var t=0;t<this.chain.exit.length;++t){var n=this.chain.exit[t];if(n.name==e){this.chain.exit[t].meta.flash=!0,this._meta.flash=!0;var r=this.engine();for(var i=0;i<n.links.length;++i)n.links[i].node&&(n.links[i].node.activateEntry(n.links[i].name),(n.links[i].node.debugBreak()||r&&r.stepping())&&this.chain.exit[t].meta.paused++);return!0}}return!1},property:function(e,t,n,r){for(var i=0;i<this.properties.length;++i){var s=this.properties[i];if(s.name===e){if(t!==undefined){var o=s.value;switch(s.type){case wcPlay.PROPERTY.TOGGLE:t=t?!0:!1;break;case wcPlay.PROPERTY.NUMBER:var u=s.options.min!==undefined?s.options.min:-Infinity,f=s.options.max!==undefined?s.options.max:Infinity,l=Math.min(f,Math.max(u,parseInt(t)));isNaN(l)&&(t=Math.min(f,Math.max(u,0)));break;case wcPlay.PROPERTY.STRING:var c=s.options.maxlength;c&&(t=t.toString().substring(0,c));break;case wcPlay.PROPERTY.SELECT:var h=s.options.items;typeof h=="function"&&(h=h.call(this));var p=!1;if($.isArray(h))for(var i=0;i<h.length;++i)if(typeof h[i]=="object"){if(h[i].value==t){p=!0;break}}else if(h[i]==t){p=!0;break}p||(t="")}var d=this.engine();s.outputMeta.flash=!0,(this.debugBreak()||d&&d.stepping())&&s.outputMeta.paused++;if(n||s.value!==t)t=this.onPropertyChanging(s.name,o,t)||t;if(n||s.value!==t){this._meta.dirty=!0,s.value=t,this.onPropertyChanged(s.name,o,t);if(n===undefined||n)for(a=0;a<s.outputs.length;++a)s.outputs[a].node&&s.outputs[a].node.activateProperty(s.outputs[a].name,t);if(r)for(a=0;a<s.inputs.length;++a)s.inputs[a].node&&s.inputs[a].node.activateProperty(s.inputs[a].name,t,!0)}}return this.onPropertyGet(s.name)||s.value}}},initialProperty:function(e,t,n,r){for(var i=0;i<this.properties.length;++i){var s=this.properties[i];if(s.name===e){if(t!==undefined){t=this.onInitialPropertyChanging(s.name,s.initialValue,t)||t,s.value==s.initialValue&&this.property(e,t);var o=s.initialValue;if(n||s.initialValue!==t){this._meta.dirty=!0,s.initialValue=t,this.onInitialPropertyChanged(s.name,o,t),s.outputMeta.flash=!0;var u=this.engine();(this.debugBreak()||u&&u.stepping())&&s.outputMeta.paused++;if(n===undefined||n)for(a=0;a<s.outputs.length;++a)s.outputs[a].node&&s.outputs[a].node.initialProperty(s.outputs[a].name,t);if(r)for(a=0;a<s.inputs.length;++a)s.inputs[a].node&&s.inputs[a].node.initialProperty(s.inputs[a].name,t,undefined,!0)}}return this.onInitialPropertyGet(s.name)||s.initialValue}}},activateProperty:function(e,t,n){var r=this.engine();r&&r.queueNodeProperty(this,e,t,n);for(var i=0;i<this.properties.length;++i){var s=this.properties[i];s.name===e&&(s.inputMeta.flash=!0,(this.debugBreak()||r&&r.stepping())&&s.inputMeta.paused++)}},listEntryChains:function(e,t){var n=[];for(var r=0;r<this.chain.entry.length;++r)if(!e||this.chain.entry[r].name===e){var i=this.chain.entry[r];for(var s=0;s<i.links.length;++s)(!t||t.indexOf(i.links[s].node)===-1)&&n.push({inName:i.name,inNodeId:this.id,outName:i.links[s].name,outNodeId:i.links[s].node.id})}return n},listExitChains:function(e,t){var n=[];for(var r=0;r<this.chain.exit.length;++r)if(!e||this.chain.exit[r].name===e){var i=this.chain.exit[r];for(var s=0;s<i.links.length;++s)(!t||t.indexOf(i.links[s].node)===-1)&&n.push({inName:i.links[s].name,inNodeId:i.links[s].node.id,outName:i.name,outNodeId:this.id})}return n},listInputChains:function(e,t){var n=[];for(var r=0;r<this.properties.length;++r)if(!e||this.properties[r].name===e){var i=this.properties[r];for(var s=0;s<i.inputs.length;++s)(!t||t.indexOf(i.inputs[s].node)===-1)&&n.push({inName:i.name,inNodeId:this.id,outName:i.inputs[s].name,outNodeId:i.inputs[s].node.id})}return n},listOutputChains:function(e,t){var n=[];for(var r=0;r<this.properties.length;++r)if(!e||this.properties[r].name===e){var i=this.properties[r];for(var s=0;s<i.outputs.length;++s)(!t||t.indexOf(i.outputs[s].node)===-1)&&n.push({inName:i.outputs[s].name,inNodeId:i.outputs[s].node.id,outName:i.name,outNodeId:this.id})}return n},listProperties:function(){var e=[];for(var t=0;t<this.properties.length;++t){var n=this.properties[t];e.push({name:n.name,value:n.value,initialValue:n.initialValue})}return e},viewportSize:function(e,t){return e!==undefined&&t!==undefined&&(this._meta.dirty=!0,!e||!t?this._viewportSize=null:this._viewportSize={x:e,y:t}),{x:this._viewportSize.x,y:this._viewportSize.y}},onViewportDraw:function(e,t){},onViewportMouseEnter:function(e,t,n){this.debugLog()&&console.log('DEBUG: Node "'+this.category+"."+this.type+(this.name?" ("+this.name+")":"")+'" mouse entered custom viewport!')},onViewportMouseLeave:function(e,t){this.debugLog()&&console.log('DEBUG: Node "'+this.category+"."+this.type+(this.name?" ("+this.name+")":"")+'" mouse left custom viewport!')},onViewportMouseDown:function(e,t,n){},onViewportMouseUp:function(e,t,n){},onViewportMouseMove:function(e,t,n){},onViewportMouseWheel:function(e,t,n,r){},onViewportMouseClick:function(e,t,n){},onViewportMouseDoubleClick:function(e,t,n){},onConnect:function(e,t,n,r,i,s){e&&n===wcNode.LINK_TYPE.OUTPUT&&(r.activateProperty(i,this.property(t)),r.initialProperty(i,this.initialProperty(t)))},onStart:function(){this.debugLog()&&console.log('DEBUG: Node "'+this.category+"."+this.type+(this.name?" ("+this.name+")":"")+'" started!')},onDraw:function(){},onTriggered:function(e){this.debugLog()&&console.log('DEBUG: Node "'+this.category+"."+this.type+(this.name?" ("+this.name+")":"")+'" Triggered Entry link "'+e+'"')},onMoving:function(e,t){},onMoved:function(e,t){},onNameChanging:function(e,t){},onNameChanged:function(e,t){this._meta.dirty=!0},onPropertyChanging:function(e,t,n){},onPropertyChanged:function(e,t,n){this.debugLog()&&console.log('DEBUG: Node "'+this.category+"."+this.type+(this.name?" ("+this.name+")":"")+'" Changed Property "'+e+'" from "'+t+'" to "'+n+'"')},onPropertyGet:function(e){},onInitialPropertyChanging:function(e,t,n){},onInitialPropertyChanged:function(e,t,n){this.debugLog()&&console.log('DEBUG: Node "'+this.category+"."+this.type+(this.name?" ("+this.name+")":"")+'" Changed Property "'+e+'" from "'+t+'" to "'+n+'"')},onInitialPropertyGet:function(e){},onImporting:function(e,t){},onImported:function(e,t){},onExport:function(e){},onReset:function(){},onDestroying:function(){},onDestroyed:function(){}}),wcNode.LINK_TYPE={ENTRY:"entry",EXIT:"exit",INPUT:"input",OUTPUT:"output"},wcNode.CONNECT_RESULT={NOT_FOUND:"not_found",ALREADY_CONNECTED:"already_connected",SUCCESS:"success"},wcNode.PROPERTY_ENABLED="enabled",wcNode.extend("wcNodeEntry","Entry Node","",{init:function(e,t){this._super(e,t),this.color="#CCCC00",this.createExit("out")},classInit:function(e,t,n){n&&(this.className=e,this.type=t,this.nodeType=wcPlay.NODE.ENTRY,this.category=n,wcPlay.registerNodeType(e,t,n,wcPlay.NODE.ENTRY))},onTriggered:function(e){this._super(e),this.activateExit("out")}}),wcNode.extend("wcNodeProcess","Node Process","",{init:function(e,t){this._super(e,t),this.color="#007ACC",this.createEntry("in"),this.createExit("out")},classInit:function(e,t,n){n&&(this.className=e,this.type=t,this.nodeType=wcPlay.NODE.PROCESS,this.category=n,wcPlay.registerNodeType(e,t,n,wcPlay.NODE.PROCESS))}}),wcNode.extend("wcNodeStorage","Storage","",{init:function(e,t){this._super(e,t),this.color="#009900"},classInit:function(e,t,n){n&&(this.className=e,this.type=t,this.nodeType=wcPlay.NODE.STORAGE,this.category=n,wcPlay.registerNodeType(e,t,n,wcPlay.NODE.STORAGE))},onStart:function(){this._super(),this.property("value",this.property("value"),!0)}}),wcNode.extend("wcNodeComposite","Composite","",{init:function(e,t){this._super(e,t),this.color="#990099",this.removeEntry("in"),this.removeExit("out")},classInit:function(e,t,n){n&&(this.className=e,this.type=t,this.nodeType=wcPlay.NODE.COMPOSITE,this.category=n,wcPlay.registerNodeType(e,t,n,wcPlay.NODE.COMPOSITE))}}),wcNodeComposite.extend("wcNodeCompositeScript","Composite","Imported",{init:function(e,t,n){this._super(e,t),this._entryNodes=[],this._processNodes=[],this._storageNodes=[],this._compositeNodes=[];if($.isArray(n))for(var r=0;r<n.length;++r)this.__addNode(n[r]),n[r]._parent=this},isPaused:function(){for(var e=0;e<this._compositeNodes.length;++e)if(this._compositeNodes[e].isPaused())return!0;for(var e=0;e<this._entryNodes.length;++e)if(this._entryNodes[e].isPaused())return!0;for(var e=0;e<this._processNodes.length;++e)if(this._processNodes[e].isPaused())return!0;for(var e=0;e<this._storageNodes.length;++e)if(this._storageNodes[e].isPaused())return!0;return this._super()},compile:function(){function e(e){for(var t=0;t<e.length;++t)this.compiledNodes.push(e[t].export())}this.compiledNodes=[],e.call(this,this._entryNodes),e.call(this,this._storageNodes),e.call(this,this._processNodes),e.call(this,this._compositeNodes)},decompile:function(e){this.onDestroying();var t=[],n=[];if(this.compiledNodes){for(var r=0;r<this.compiledNodes.length;++r){var i=this.compiledNodes[r];if(window[i.className]){var s=new window[i.className](this,i.pos,i.name);e||(t[i.id]=s.id),n.push(s)}else console.log('ERROR: Attempted to load node "'+this.compiledNodes[r].className+'", but the constructor could not be found!'),n.push(null)}for(var r=0;r<this.compiledNodes.length;++r)if(n[r]){var i=this.compiledNodes[r];n[r].import(i,t)}}},nodeById:function(e){for(var t=0;t<this._entryNodes.length;++t)if(this._entryNodes[t].id===e)return this._entryNodes[t];for(var t=0;t<this._processNodes.length;++t)if(this._processNodes[t].id===e)return this._processNodes[t];for(var t=0;t<this._storageNodes.length;++t)if(this._storageNodes[t].id===e)return this._storageNodes[t];for(var t=0;t<this._compositeNodes.length;++t)if(this._compositeNodes[t].id===e)return this._compositeNodes[t];for(var t=0;t<this._compositeNodes.length;++t)if(this._compositeNodes[t]instanceof wcNodeCompositeScript){var n=this._compositeNodes[t].nodeById(e);if(n)return n}return null},sortEntryLinks:function(){var e=[];for(var t=0;t<this._compositeNodes.length;++t){var n=this._compositeNodes[t];n instanceof wcNodeCompositeEntry&&e.push({name:n.name,pos:n.pos.x})}e.sort(function(e,t){return e.pos-t.pos});var r=this.chain.entry;this.chain.entry=[];for(var t=0;t<e.length;++t){var i=e[t].name;for(var s=0;s<r.length;++s)r[s].name===i&&this.chain.entry.push(r[s])}},sortExitLinks:function(){var e=[];for(var t=0;t<this._compositeNodes.length;++t){var n=this._compositeNodes[t];n instanceof wcNodeCompositeExit&&e.push({name:n.name,pos:n.pos.x})}e.sort(function(e,t){return e.pos-t.pos});var r=this.chain.exit;this.chain.exit=[];for(var t=0;t<e.length;++t){var i=e[t].name;for(var s=0;s<r.length;++s)r[s].name===i&&this.chain.exit.push(r[s])}},sortPropertyLinks:function(){var e=[];for(var t=0;t<this._compositeNodes.length;++t){var n=this._compositeNodes[t];n instanceof wcNodeCompositeProperty&&e.push({name:n.name,pos:n.pos.y})}e.sort(function(e,t){return e.pos-t.pos});var r=this.properties;this.properties=[r[0]],r.splice(0,1);for(var t=0;t<e.length;++t){var i=e[t].name;for(var s=0;s<r.length;++s)r[s].name===i&&(this.properties.push(r[s]),r.splice(s,1),s--)}},onDraw:function(){this._super(),this._meta.awake=!1;for(var e=0;e<this._entryNodes.length;++e)if(this._entryNodes[e]._meta.awake){this._meta.awake=!0,this._meta.flash=!0;return}for(var e=0;e<this._processNodes.length;++e)if(this._processNodes[e]._meta.awake){this._meta.awake=!0,this._meta.flash=!0;return}for(var e=0;e<this._storageNodes.length;++e)if(this._storageNodes[e]._meta.awake){this._meta.awake=!0,this._meta.flash=!0;return}for(var e=0;e<this._compositeNodes.length;++e){this._compositeNodes[e]instanceof wcNodeCompositeScript&&this._compositeNodes[e].onDraw();if(this._compositeNodes[e]._meta.awake){this._meta.awake=!0,this._meta.flash=!0;return}}},onTriggered:function(e){this._super(e);for(var t=0;t<this._compositeNodes.length;++t){var n=this._compositeNodes[t];if(n instanceof wcNodeCompositeEntry&&n.name===e){n.activateExit("out");break}}},onNameChanged:function(e,t){this._super(e,t)},onPropertyChanged:function(e,t,n){this._super(e,t,n);for(var r=0;r<this._compositeNodes.length;++r){var i=this._compositeNodes[r];i instanceof wcNodeCompositeProperty&&i.name===e&&i.property("value",n,!0)}},onImporting:function(e,t){this.compiledNodes=e.nodes,this.decompile(t?!1:!1),this._super(e,t)},onExport:function(e){this._super(e),this.compile(),e.nodes=this.compiledNodes},onReset:function(){this._super();for(var e=0;e<this._compositeNodes.length;++e)this._compositeNodes[e].reset();for(var e=0;e<this._entryNodes.length;++e)this._entryNodes[e].reset();for(var e=0;e<this._processNodes.length;++e)this._processNodes[e].reset();for(var e=0;e<this._storageNodes.length;++e)this._storageNodes[e].reset()},onDestroyed:function(){this._super();for(var e=0;e<this._entryNodes.length;++e)this._entryNodes[e].destroy();for(var e=0;e<this._processNodes.length;++e)this._processNodes[e].destroy();for(var e=0;e<this._storageNodes.length;++e)this._storageNodes[e].destroy();for(var e=0;e<this._compositeNodes.length;++e)this._compositeNodes[e].destroy();this._entryNodes=[],this._processNodes=[],this._storageNodes=[],this._compositeNodes=[]},__addNode:function(e){e instanceof wcNodeEntry?this._entryNodes.push(e):e instanceof wcNodeProcess?this._processNodes.push(e):e instanceof wcNodeStorage?this._storageNodes.push(e):e instanceof wcNodeComposite&&this._compositeNodes.push(e)},__removeNode:function(e){var t=-1;e instanceof wcNodeEntry?(t=this._entryNodes.indexOf(e),t>-1&&this._entryNodes.splice(t,1)):e instanceof wcNodeProcess?(t=this._processNodes.indexOf(e),t>-1&&this._processNodes.splice(t,1)):e instanceof wcNodeStorage?(t=this._storageNodes.indexOf(e),t>-1&&this._storageNodes.splice(t,1)):e instanceof wcNodeComposite&&(t=this._compositeNodes.indexOf(e),t>-1&&this._compositeNodes.splice(t,1));if(t===-1)for(var n=0;n<this._compositeNodes.length;++n)if(this._compositeNodes[n]instanceof wcNodeCompositeScript&&this._compositeNodes[n].__removeNode(e))return!0;return!1},__notifyNodes:function(e,t){var n;for(var r=0;r<this._storageNodes.length;++r)n=this._storageNodes[r],typeof n[e]=="function"&&n[e].apply(n,t);for(var r=0;r<this._processNodes.length;++r)n=this._processNodes[r],typeof n[e]=="function"&&n[e].apply(n,t);for(var r=0;r<this._entryNodes.length;++r)n=this._entryNodes[r],typeof n[e]=="function"&&n[e].apply(n,t);for(var r=0;r<this._compositeNodes.length;++r)n=this._compositeNodes[r],typeof n[e]=="function"&&n[e].apply(n,t);for(var r=0;r<this._compositeNodes.length;++r)this._compositeNodes[r]instanceof wcNodeCompositeScript&&this._compositeNodes[r].__notifyNodes(e,t)}}),wcNodeComposite.extend("wcNodeCompositeEntry","Entry","External",{init:function(e,t,n){this._super(e,t),e instanceof wcNodeCompositeScript||(this._invalid=!0),this.description("Activates when the corresponding Entry link of the parent Composite node has been activated."),n=n||"in";var r=n;if(!this._invalid){var i=0;for(;;){if(this._parent.createEntry(r))break;i++,r=n+i}}this.removeEntry("in"),this.createExit("out"),this.name=r},onNameChanging:function(e,t){this._super(e,t);if(this._invalid)return;for(var n=0;n<this._parent.chain.entry.length;++n)if(this._parent.chain.entry[n].name===t)return e},onNameChanged:function(e,t){this._super(e,t);if(this._invalid)return;this._parent.renameEntry(e,t),this._parent.sortEntryLinks()},onMoved:function(e,t){this._super(e,t);if(this._invalid)return;this._parent.sortEntryLinks()},onDestroyed:function(){this._super();if(this._invalid)return;this._parent.sortEntryLinks()},onImporting:function(e,t){this._super(e,t);if(!this._invalid&&e.name!==this.name){var n=e.name;this._parent.removeEntry(this.name);var r=0;for(;;){if(this._parent.createEntry(n))break;r++,n=e.name+r}e.name=n}},onImported:function(e,t){this._super(e,t),this._parent.sortEntryLinks()}}),wcNodeComposite.extend("wcNodeCompositeExit","Exit","External",{init:function(e,t,n){this._super(e,t),e instanceof wcNodeCompositeScript||(this._invalid=!0),this.description("Activates the corresponding Exit link of the parent Composite node when it has been activated."),n=n||"out";var r=n;if(!this._invalid){var i=0;for(;;){if(this._parent.createExit(r))break;i++,r=n+i}}this.createEntry("in"),this.removeExit("out"),this.name=r},onTriggered:function(e){this._super(e);if(this._invalid)return;this._parent.activateExit(this.name)},onNameChanging:function(e,t){this._super(e,t);if(this._invalid)return;for(var n=0;n<this._parent.chain.exit.length;++n)if(this._parent.chain.exit[n].name===t)return e},onNameChanged:function(e,t){this._super(e,t);if(this._invalid)return;this._parent.renameExit(e,t),this._parent.sortExitLinks()},onMoved:function(e,t){this._super(e,t);if(this._invalid)return;this._parent.sortExitLinks()},onDestroyed:function(){this._super();if(this._invalid)return;this._parent.sortExitLinks()},onImporting:function(e,t){this._super(e,t);if(!this._invalid&&e.name!==this.name){var n=e.name;this._parent.removeExit(this.name);var r=0;for(;;){if(this._parent.createExit(n))break;r++,n=e.name+r}e.name=n}},onImported:function(e,t){this._super(e,t),this._parent.sortExitLinks()}}),wcNodeComposite.extend("wcNodeCompositeProperty","Property","External",{init:function(e,t,n){this._super(e,t),e instanceof wcNodeCompositeScript||(this._invalid=!0),this.description("References a property from its parent Composite Node."),this.name=n||"value",this._invalid||this._parent&&this._parent.createProperty(this.name,wcPlay.PROPERTY.STRING,""),this.createProperty("value",wcPlay.PROPERTY.STRING,"")},onNameChanged:function(e,t){this._super(e,t);if(this._invalid)return;if(t){if(this._parent){this._parent.createProperty(t,wcPlay.PROPERTY.STRING,"");var n=this._parent.listInputChains(e),r=this._parent.listOutputChains(e),i=this.engine();if(i){for(var s=0;s<n.length;++s)this._parent.connectInput(t,i.nodeById(n[s].outNodeId),n[s].outName);for(var s=0;s<r.length;++s)this._parent.connectOutput(t,i.nodeById(r[s].inNodeId),r[s].inName)}this._parent.sortPropertyLinks()}this.property("value",this.property("value"))}else this.property("value","")},onPropertyChanging:function(e,t,n){this._super(e,t,n);if(this._invalid)return"";e==="value"&&this.name&&this._parent&&this._parent.property(this.name,n)},onPropertyGet:function(e){this._super(e);if(this._invalid)return"";if(e==="value"&&this.name)return this._parent.property(this.name)},onInitialPropertyChanging:function(e,t,n){this._super(e,t,n);if(this._invalid)return"";e==="value"&&this.name&&this._parent.initialProperty(this.name,n)},onInitialPropertyGet:function(e){this._super(e);if(this._invalid)return"";if(e==="value"&&this.name)return this._parent.initialProperty(this.name)},onMoved:function(e,t){this._super(e,t);if(this._invalid)return;this._parent.sortPropertyLinks()},onDestroyed:function(){this._super();if(this._invalid)return;this._parent.sortPropertyLinks()}}),wcNodeEntry.extend("wcNodeEntryStart","Start","Core",{init:function(e,t){this._super(e,t),this.description("Event that fires once on script execution.")},onStart:function(){this._super(),this.onTriggered()}}),wcNodeEntry.extend("wcNodeEntryUpdate","Update","Core",{init:function(e,t){this._super(e,t),this.description("Event that fires continuously."),this.createProperty("milliseconds",wcPlay.PROPERTY.NUMBER,1e3,{description:"The time, in milliseconds, per update."})},onTriggered:function(e){function n(){t.activateExit("out"),t.finishThread(r),r=t.beginThread(setTimeout(n,t.property("milliseconds")))}var t=this;this.reset();var r=this.beginThread(setTimeout(n,this.property("milliseconds")))},onStart:function(){this._super(),this.onTriggered()}}),wcNodeProcess.extend("wcNodeProcessDelay","Delay","Core",{init:function(e,t){this._super(e,t),this.description("Waits for a specified amount of time before continuing the flow chain."),this.createProperty("milliseconds",wcPlay.PROPERTY.NUMBER,1e3,{description:"The time delay, in milliseconds, to wait before firing the 'out' Exit link."})},onTriggered:function(e){this._super(e);var t=this,n=this.property("milliseconds"),r=this.beginThread(setTimeout(function(){t.activateExit("out"),t.finishThread(r)},n))}}),wcNodeProcess.extend("wcNodeProcessOperation","Operation","Core",{init:function(e,t){this._super(e,t),this.description("Performs a simple math operation on two values."),this.removeEntry("in"),this.createEntry("add","valueA + valueB = result"),this.createEntry("sub","valueA - valueB = result"),this.createEntry("mul","valueA * valueB = result"),this.createEntry("div","valueA / valueB = result"),this.createProperty("valueA",wcPlay.PROPERTY.NUMBER,0,{description:"Left hand value for the operation."}),this.createProperty("valueB",wcPlay.PROPERTY.NUMBER,0,{description:"Right hand value for the operation."}),this.createProperty("result",wcPlay.PROPERTY.NUMBER,0,{description:"The result of the operation."})},onTriggered:function(e){this._super(e);var t=parseFloat(this.property("valueA")),n=parseFloat(this.property("valueB")),r;switch(e){case"add":r=t+n;break;case"sub":r=t-n;break;case"mul":r=t*n;break;case"div":r=t/n}this.property("result",r,!0),this.activateExit("out")}}),wcNodeProcess.extend("wcNodeProcessStrCat","String Concat","Core",{init:function(e,t){this._super(e,t),this.description("Concatenates two string values."),this.createProperty("valueA",wcPlay.PROPERTY.STRING,"",{description:"The left side string to join."}),this.createProperty("valueB",wcPlay.PROPERTY.STRING,"",{description:"The right side string to join."}),this.createProperty("result",wcPlay.PROPERTY.STRING,"",{description:"The concatenated result."})},onTriggered:function(e){this._super(e),this.activateExit("out"),this.property("result",this.property("valueA").toString()+this.property("valueB"))}}),wcNodeProcess.extend("wcNodeProcessAlert","Alert","Debugging",{init:function(e,t){this._super(e,t),this.description("For debugging purposes, will popup an alert box with a message the moment it is activated (only if silent mode is not on)."),this.createProperty("message",wcPlay.PROPERTY.STRING,"Alert message.",{multiline:!0,description:"The message that will appear in the alert box."})},onTriggered:function(e){this._super(e),this.activateExit("out");var t=this.engine();if(!t||t.silent())return;var n=this.property("message");alert(n)}}),wcNodeProcess.extend("wcNodeProcessConsoleLog","Console Log","Debugging",{init:function(e,t){this._super(e,t),this.description("For debugging purposes, will print out a message into the console log the moment it is activated (only if silent mode is not on)."),this.createProperty("message",wcPlay.PROPERTY.STRING,"msg",{description:"The message that will appear in the console log."})},onTriggered:function(e){this._super(e),this.activateExit("out");var t=this.engine();if(!t||t.silent())return;var n=this.property("message");console.log(n)}}),wcNodeStorage.extend("wcNodeStorageGlobal","Global","Core",{init:function(e,t){this._super(e,t),this.color="#77CC77",this.description("References a global property on the script."),this.createProperty("value",wcPlay.PROPERTY.STRING,"",{description:"The current value of the global property (Use the title to identify the property)."})},onNameChanged:function(e,t){this._super(e,t);var n=this.engine();if(n){n.createProperty(t,wcPlay.PROPERTY.STRING,"");var r=n.listProperties();for(var i=0;i<window.wcNodeInstances.wcNodeStorageGlobal.length;++i){if(window.wcNodeInstances.wcNodeStorageGlobal[i].engine()!==n)continue;var s=window.wcNodeInstances.wcNodeStorageGlobal[i].name;for(var o=0;o<r.length;++o)if(r[o].name===s){r.splice(o,1);break}}for(var i=0;i<r.length;++i)n.removeProperty(r[i].name)}},onPropertyChanged:function(e,t,n){this._super(e,t,n);if(e==="value"&&this.name){var r=this.engine();r&&r.property(this.name,n)}},onPropertyGet:function(e){this._super(e);if(e==="value"&&this.name){var t=this.engine();return t&&t.property(this.name)||0}},onInitialPropertyChanging:function(e,t,n){this._super(e,t,n);if(e==="value"&&this.name){var r=this.engine();r&&r.initialProperty(this.name,n)}},onInitialPropertyGet:function(e){this._super(e);if(e==="value"&&this.name){var t=this.engine();return t&&t.initialProperty(this.name)||0}},onGlobalPropertyChanged:function(e,t,n){this.name==e&&this.property("value",this.property("value"),!0,!0)},onGlobalPropertyRemoved:function(e){this.name==e&&(this.name="")},onGlobalPropertyRenamed:function(e,t){this.name==e&&(this.name=t)}}),wcNodeStorage.extend("wcNodeStorageToggle","Toggle","Core",{init:function(e,t){this._super(e,t),this.description("Stores a boolean (toggleable) value."),this.createProperty("value",wcPlay.PROPERTY.TOGGLE,!1)}}),wcNodeStorage.extend("wcNodeStorageNumber","Number","Core",{init:function(e,t){this._super(e,t),this.description("Stores a number value."),this.createProperty("value",wcPlay.PROPERTY.NUMBER)}}),wcNodeStorage.extend("wcNodeStorageString","String","Core",{init:function(e,t){this._super(e,t),this.description("Stores a string value."),this.createProperty("value",wcPlay.PROPERTY.STRING,"",{multiline:!0})}})